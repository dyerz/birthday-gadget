  <?xml version="1.0" encoding="UTF-8" ?> 
- <Module>
- <ModulePrefs title="__UP_title__" category="tools" render_inline="required" scrolling="false" author="Sophia B." directory_title="__MSG_todo__" author_email="sophia.feedback+todo@gmail.com" author_affiliation="Google Inc." author_location="Mountain View, CA" screenshot="/ig/modules/todo.png" singleton="false" thumbnail="/ig/modules/todo-thm.png" description="__MSG_description__">
  <Locale messages="todo_content/todo_en.xml" /> 
  <Locale lang="ja" messages="todo_content/todo_ja.xml" /> 
  <Locale lang="pt-BR" messages="todo_content/todo_pt-br.xml" /> 
  <Locale lang="ko" messages="todo_content/todo_ko.xml" /> 
  <Locale lang="es" messages="todo_content/todo_es.xml" /> 
  <Locale lang="fr" messages="todo_content/todo_fr.xml" /> 
  <Locale lang="ru" messages="todo_content/todo_ru.xml" /> 
  <Locale lang="zh-CN" messages="todo_content/todo_zh-cn.xml" /> 
  <Locale lang="nl" messages="todo_content/todo_nl.xml" /> 
  <Locale lang="fi" messages="todo_content/todo_fi.xml" /> 
  <Locale lang="de" messages="todo_content/todo_de.xml" /> 
  <Locale lang="no" messages="todo_content/todo_no.xml" /> 
  <Locale lang="sv" messages="todo_content/todo_sv.xml" /> 
  <Locale lang="it" messages="todo_content/todo_it.xml" /> 
  <Locale lang="da" messages="todo_content/todo_da.xml" /> 
  </ModulePrefs>
  <UserPref name="title" display_name="__MSG_title__" required="false" default_value="__MSG_todo__" /> 
- <UserPref name="bgcolor" display_name="__MSG_background_color__" default_value="#e5ecf9" datatype="enum">
  <EnumValue display_value="__MSG_yellow__" value="#ffffcc" /> 
  <EnumValue display_value="__MSG_blue__" value="#e5ecf9" /> 
  <EnumValue display_value="__MSG_gray__" value="#efefef" /> 
  <EnumValue display_value="__MSG_green__" value="#e0eee0" /> 
  <EnumValue display_value="__MSG_pink__" value="#fff0f5" /> 
  <EnumValue display_value="__MSG_orange__" value="#fff5ee" /> 
  </UserPref>
  <UserPref name="todos" default_value="" datatype="hidden" /> 
- <Content type="html">
- <![CDATA[ 

      <script language="JavaScript"
        src="/ig/modules/todo_content/json.js"></script>
      <script language="JavaScript">
        var todos__MODULE_ID__; // This is a json object of todo items
        var edited__MODULE_ID_;
        var prefs__MODULE_ID__;

        _IG_RegisterOnloadHandler(
          function loadTodos__MODULE_ID__() {
            prefs__MODULE_ID__ = new _IG_Prefs(__MODULE_ID__);
            var todosstring = prefs__MODULE_ID__.getString("todos");
            if (todosstring == "")
              todos__MODULE_ID__ = {"array":[]};
            else
              todos__MODULE_ID__ = JSON.parse(todosstring);
            edited__MODULE_ID__ = false;
            createTable__MODULE_ID__();
          }
        )

        function saveTodos__MODULE_ID__(){
          prefs__MODULE_ID__.set("todos", JSON.stringify(todos__MODULE_ID__));
          _gel("newTodoInput__MODULE_ID__").focus();
        }

        function addTodo__MODULE_ID__(name, priority) {
          var name = _trim(name);
          _gel("newTodoInput__MODULE_ID__").value = "";
          if (name == "")
            return;
          todos__MODULE_ID__.array[numTodos__MODULE_ID__()] =
                {"name": name, "priority": priority};
          createTable__MODULE_ID__();
          saveTodos__MODULE_ID__();
          return false;
        }

        function deleteTodo__MODULE_ID__(number) {
          if (edited__MODULE_ID__)
            return;
          var beginning = todos__MODULE_ID__.array.slice(0, number);
          var end = todos__MODULE_ID__.array.slice(number + 1,
                                                   numTodos__MODULE_ID__());
          todos__MODULE_ID__.array = beginning.concat(end);
          createTable__MODULE_ID__();
          saveTodos__MODULE_ID__();
        }

        function swapTodos__MODULE_ID__(to, from) {
          var temp = todos__MODULE_ID__.array[to];
          todos__MODULE_ID__.array[to] = todos__MODULE_ID__.array[from];
          todos__MODULE_ID__.array[from] = temp;
        }

        function sortByPriority__MODULE_ID__(number) {
          var todo = todos__MODULE_ID__.array[number];;
          var lastPriority = todo.priority;
          for (i = number + 1; i < numTodos__MODULE_ID__(); i++) {
            var currentTodo = todos__MODULE_ID__.array[i];
            if (currentTodo == null)
              break;
            var currentPriority = currentTodo.priority;
            if (currentPriority >= lastPriority)
              break;
            swapTodos__MODULE_ID__(i, i - 1);
          }
          for (i = number - 1; i >= 0; i--) {
            var currentTodo = todos__MODULE_ID__.array[i];
            if (currentTodo == null)
              break;
            var currentPriority = currentTodo.priority;
            if (currentPriority <= lastPriority)
              break;
            swapTodos__MODULE_ID__(i + 1, i);
          }
        }

        function setPriority__MODULE_ID__(number, priority) {
          var row = getRow__MODULE_ID__(number);
          var col = getCol__MODULE_ID__(row, 0);
          col.innerHTML = createPriorityLink__MODULE_ID__(priority, number);
          todos__MODULE_ID__.array[number].priority = priority;
          sortByPriority__MODULE_ID__(number);
          createTable__MODULE_ID__();
          saveTodos__MODULE_ID__();
        }

        function editPriority__MODULE_ID__(number, priority) {
          var row = getRow__MODULE_ID__(number);
          if (edited__MODULE_ID__)
            return;
          edited__MODULE_ID__ = true;
          var col = getCol__MODULE_ID__(row, 0);
          col.innerHTML = createPrioritySelect__MODULE_ID__(number, priority);
        }

        function selected__MODULE_ID__(priority, num) {
          if (priority == num)
            return "selected=true";
          else
            return "";
        }

        function rowClass__MODULE_ID__(number) {
          if (number % 2 != 0)
            return " class=odd__MODULE_ID__ ";
          else
            return " class=even__MODULE_ID__ ";
        }

        function createTable__MODULE_ID__() {
          var html = "<table cellspacing=0 id=todosTable__MODULE_ID__>";
          for (i = 0; i < numTodos__MODULE_ID__(); i++) {
            if (todos__MODULE_ID__.array[i] == null)
              break;
            var priority = todos__MODULE_ID__.array[i].priority;
            var name = todos__MODULE_ID__.array[i].name;
            html = html + createRow__MODULE_ID__(i, priority, name);
          }
          html = html + "</table>";
          _gel("todosDiv__MODULE_ID__").innerHTML = html;
        }

        function createRow__MODULE_ID__(number, priority, name) {
          var html =
            "<tr id=\"row" + number + "__MODULE_ID__\"" +
              rowClass__MODULE_ID__(number) + ">" +
              "<td class=priority_td__MODULE_ID__>" +
                createPriorityLink__MODULE_ID__(priority, number) +
              "</td>" +
              "<td class=name_td__MODULE_ID__>" +
                createName__MODULE_ID__(number, name) +
              "</td>" +
              "<td>" +
                createDelete__MODULE_ID__(number) +
              "</td>" +
            "</tr>";
          return html;
        }

        function escapeName__MODULE_ID__(name) {
          name = name.replace(/&/g,"&#38;")
          name = name.replace(/</g,"&#60;")
          name = name.replace(/>/g,"&#62;")
          name = name.replace(/"/g,"&#34;")
          name = name.replace(/'/g,"&#39;")
          return name;
        }

        function createName__MODULE_ID__(number, name) {
          var html =
          "<a class=name_a__MODULE_ID__" +
            " href=\"javascript:editName__MODULE_ID__(" +  number + ")\">" +
            escapeName__MODULE_ID__(name) +
          "</a>";
          return html;
        }

        function createDelete__MODULE_ID__(number) {
          var html =
            "<a href=\"javascript:deleteTodo__MODULE_ID__(" + number + ")\">" +
              "<img class=delete__MODULE_ID__" +
                " src=\"http://www.google.com/ig/modules/todo_content/x.gif\">" +
            "</a>";
          return html;
        }


        function createPrioritySelect__MODULE_ID__(number, priority) {
          var html =
            "<select id=select__MODULE_ID__ " +
               "onchange=\"submitPriority__MODULE_ID__(" + number + ")\">" +
               "<option class=option__MODULE_ID__ value=1 " +
                 "onclick=\"submitPriority__MODULE_ID__(" + number + ")\" " +
                 selected__MODULE_ID__(priority, 1) + ">" +
                 "__MSG_high__" +
               "</option>" +
               "<option class=option__MODULE_ID__ value=2 " +
                 "onclick=\"submitPriority__MODULE_ID__(" + number + ")\" " +
                 selected__MODULE_ID__(priority, 2) + ">" +
                 "__MSG_medium__" +
               "</option>" +
               "<option class=option__MODULE_ID__ value=3 " +
                 "onclick=\"submitPriority__MODULE_ID__(" + number + ")\" " +
                 selected__MODULE_ID__(priority, 3) + ">" +
                 "__MSG_low__" +
               "</option>" +
              "</select>";
           return html;
        }

        function createPriorityLink__MODULE_ID__(priority, number) {
          var html =
            "<a class=p" + priority + "___MODULE_ID__ " +
              "href=\"javascript:editPriority__MODULE_ID__(" +
              number + "," + priority + ")\">" +
              getPriorityText__MODULE_ID__(priority) +
            "</a>";
          return html;
        }

        function createEditNameForm__MODULE_ID__(number, name) {
          var html =
            "<input onkeypress=\"if (isEnter__MODULE_ID__(event))" +
              "{setName__MODULE_ID__(" + number+ ", event); return false;}\" " +
              "type=text id=name_input__MODULE_ID__ value=\"" + name + "\">";
          return html;
        }


        function getPriorityText__MODULE_ID__(priority) {
          if (priority == 1)
            return "__MSG_high__";
          else if (priority == 2)
            return "__MSG_medium__";
          return "__MSG_low__";
        }

        function submitPriority__MODULE_ID__(number) {
          var row = getRow__MODULE_ID__(number);
          var col = getCol__MODULE_ID__(row, 0);
          var select = _gel("select__MODULE_ID__");
          var newPriority = select.options[select.selectedIndex].value;
          setPriority__MODULE_ID__(number, newPriority);
          edited__MODULE_ID__ = false;
        }

        function editName__MODULE_ID__(number) {
          if (edited__MODULE_ID__)
            return;
          edited__MODULE_ID__ = true;
          var row = getRow__MODULE_ID__(number);
          var col = getCol__MODULE_ID__(row, 1);
          var name = todos__MODULE_ID__.array[number].name;
          col.innerHTML = createEditNameForm__MODULE_ID__(number, name);
          _gel("name_input__MODULE_ID__").focus();
          _gel("name_input__MODULE_ID__").select();
        }

        function setName__MODULE_ID__(number) {
          var name = _trim(_gel("name_input__MODULE_ID__").value);
          if (name == "")
            name = todos__MODULE_ID__.array[number].name;
          todos__MODULE_ID__.array[number].name = name;
          var row = getRow__MODULE_ID__(number);
          var col = getCol__MODULE_ID__(row, 1);
          col.innerHTML = createName__MODULE_ID__(number,name);
          saveTodos__MODULE_ID__();
          edited__MODULE_ID__ = false;
          return false;
        }

        function edit__MODULE_ID__() {
          return edited__MODULE_ID__;
        }

        function isEnter__MODULE_ID__(e) {
          var characterCode;
            if(e && e.which){
              e = e
              characterCode = e.which
            } else {
              e = event
              characterCode = e.keyCode
            }
            if (characterCode == 13)
              return true;
            return false
         }

        function getTable__MODULE_ID__() {
          return _gel('todosTable__MODULE_ID__');
        }

        function getRow__MODULE_ID__(number) {
          return _gel("row" + number + "__MODULE_ID__");
        }

        function getCol__MODULE_ID__(row, index) {
          return row.childNodes.item(index);
        }

        function numTodos__MODULE_ID__() {
          return todos__MODULE_ID__.array.length;
        }
      </script>

      <style type="text/css">
        .delete__MODULE_ID__ {
           border-style: none;
        }
        .priority_td__MODULE_ID__ {
          font-family: arial;
          padding-right: 20px;
          font-size: 12px;
        }
        .p1___MODULE_ID__:link, .p1___MODULE_ID__:visited {
          color: red;
          text-decoration: none;
          font-size: 12px;
        }
        .p2___MODULE_ID__:link, .p2___MODULE_ID__:visited {
          color: blue;
          text-decoration: none;
          font-size: 12px;
        }
        .p3___MODULE_ID__:link, .p3___MODULE_ID__:visited {
          color: #ff00ff;
          text-decoration: none;
          font-size: 12px;
        }
        .name_a__MODULE_ID__:link, .name_a__MODULE_ID__:visited {
          text-decoration:none;
          font-size: 12px;
          color: black;
        }
        #name_input__MODULE_ID__, #newTodoInput__MODULE_ID__ {
          width: 100%;
          font-family: arial;
          padding: 0px;
        }
        #new_todo_td__MODULE_ID__ {
          font-size: 12px
        }
        #input__MODULE_ID__ {
          font-family: arial;
          padding: 0px;
        }
        #todosTable__MODULE_ID__ {
          margin:0;
          padding:0;
          width:100%;
          font-size: 12px;
        }
        .name_td__MODULE_ID__ {
          width:100%;
        }
        .option__MODULE_ID__ {
          font-size: 12px;
          padding: 0px;
          margin: 0px;
          font-family: arial;
        }
        #select__MODULE_ID__ {
          font-family: arial;
          width: 52px;
          margin: 0px;
          padding: 0px;
        }
        .even__MODULE_ID__ {
          background: __UP_bgcolor__;
        }
        .odd__MODULE_ID__ {
          background: white;
        }
      </style>

      <form name = "newTodoForm__MODULE_ID__"
            onsubmit="return addTodo__MODULE_ID__(
                     document.newTodoForm__MODULE_ID__.
                     newTodoInput__MODULE_ID__.value, 3, false)">
        <table cellspacing=0>
          <tr>
          <td id="new_todo_td__MODULE_ID__">
            <nobr>__MSG_new_item__</nobr>
          </td>
          <td style='width:100%' >
            <input id="newTodoInput__MODULE_ID__" type="text"
                   style='width:100%'>
          </td>
          <td>
            <input type = "button" value="__MSG_add__"
                   onclick = "javascript:addTodo__MODULE_ID__(
                             document.newTodoForm__MODULE_ID__.
                             newTodoInput__MODULE_ID__.value, 3, false)">
          </td>
        </tr>
      </table>
      <div id="todosDiv__MODULE_ID__"></div>
      </form>
    

  ]]> 
  </Content>
  </Module>
